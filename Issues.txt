Make Gate the single required PR check; retire legacy PR workflows

Labels: workflows, ci, devops, refactor, enhancement, priority: high, status: ready

Summary
Adopt the Gate workflow as the sole enforcement point for PRs. It already fans out to Python 3.11, 3.12, and Docker smoke via reusables. Retire PR 10 CI Python and PR 12 Docker Smoke once Gate is wired into branch protection and downstream maintenance is listening to Gate’s completion. 
GitHub
+4
GitHub
+4
GitHub
+4

Acceptance criteria

Branch protection for the default branch requires the job gate from the Gate workflow.

PR 10 CI Python and PR 12 Docker Smoke are disabled or removed.

All downstream maintenance automations listen for workflow_run of Gate (not the legacy workflows).

Reusable CI (reusable-ci.yml) and reusable Docker (reusable-docker.yml) are the only build/test entry points. 
GitHub
+1

Task list

 Update branch protection to require the check name: Gate / gate. 
GitHub

 Update any workflow_run.workflows lists to ["Gate"].

 Disable or delete .github/workflows/pr-10-ci-python.yml and .github/workflows/pr-12-docker-smoke.yml after confirming Gate is green on a few PRs. 
GitHub
+1

 Ensure Gate includes both Python versions and Docker smoke using ./.github/workflows/reusable-ci.yml and ./.github/workflows/reusable-docker.yml. 
GitHub
+2
GitHub
+2

 Document the new required check in CONTRIBUTING.md (short section).

Implementation notes

The current Gate file is .github/workflows/pr-gate.yml and already wires 3.11, 3.12, and Docker and produces a final gate job. Leverage this as the single protected check. 
GitHub

References: pr-gate.yml, reusable-ci.yml, reusable-docker.yml, pr-10-ci-python.yml, pr-12-docker-smoke.yml. 
GitHub
+4
GitHub
+4
GitHub
+4

2) Consolidate post‑CI maintenance into a single “Maint Post‑CI” workflow and one PR comment

Labels: workflows, devops, ci, enhancement, autofix, priority: high, status: ready

Summary
Merge the current “Post CI Summary” and “Autofix” flows into one workflow that triggers once per PR on Gate completion. Emit one idempotent PR comment that contains status, coverage, and autofix results. Existing YAML already does most of this; the consolidation is primarily wiring and de‑duplication. 
GitHub
+1

Acceptance criteria

A single workflow (e.g., maint-post-ci.yml) triggers on workflow_run of Gate when the event is a PR.

Exactly one PR comment is created/updated per run with:

overall status of required jobs

coverage snippet (and trend if present)

autofix summary if changes applied

Maint 30 Post CI Summary and Maint 32 Autofix are disabled/removed after parity.

Coverage and JSON diagnostics are uploaded once under stable names, e.g. coverage-summary.md, autofix_report.json. 
GitHub
+1

Task list

 Create .github/workflows/maint-post-ci.yml with:

on: workflow_run: workflows: ["Gate"] types: [completed]

jobs: summarize, autofix (conditional), failure-tracker (optional)

 Move logic from maint-30-post-ci-summary.yml into summarize. 
GitHub

 Move logic from maint-32-autofix.yml into autofix. Retain loop guards, safe path caps, and fork patch flow. 
GitHub

 Ensure a single idempotent PR comment is written/updated rather than multiple comments.

 Upload artifacts under unified names the rest of the stack expects.

 Disable/remove maint-30-post-ci-summary.yml and maint-32-autofix.yml after successful test runs. 
GitHub
+1

Implementation notes

Maint 30 already collects coverage artifacts, and Maint 32 handles JSON reporting and patch etiquette. Keep those behaviors, just consolidate. 
GitHub
+1

References: maint-30-post-ci-summary.yml, maint-32-autofix.yml. 
GitHub
+1

3) Fix reuse-agents.yml expression bug and fully integrate bootstrap/watchdog; retire separate “Agent watchdog”

Labels: agents, workflows, devops, bug, enhancement, priority: medium, status: ready

Summary
reuse-agents.yml fails when building a JSON array using + inside a GitHub expression. Replace with a format() or emit proper JSON from the producer. Confirm agents-consumer.yml and agents-70-orchestrator.yml flow through the reusable correctly, then retire the standalone “Agent watchdog” workflow once parity is proven. 
GitHub
+3
GitHub
+3
GitHub
+3

Acceptance criteria

reuse-agents.yml successfully bootstraps a PR from a labeled Issue (agent:codex) without expression errors.

Bootstrap Codex PRs step resolves the first issue via a valid JSON expression.

Orchestrator and consumer both run clean against the reusable.

“Agent watchdog” functionality lives inside the reusable job; the separate workflow is removed/disabled. 
GitHub
+1

Task list

 Replace fromJSON('[' + steps.ready.outputs.issue_numbers + ']')[0] with either:

fromJSON(format('[{0}]', steps.ready.outputs.issue_numbers))[0], or

change “Find Ready Issues” to output a JSON array string and use fromJSON(steps.ready.outputs.issue_numbers)[0]. 
GitHub

 Run workflow_dispatch with enable_readiness, enable_watchdog, and bootstrap_issues_label=agent:codex to verify end to end. 
GitHub

 Confirm agents-consumer.yml and agents-70-orchestrator.yml call paths and inputs are aligned. 
GitHub
+1

 Disable or delete the separate “Agent watchdog” workflow after verification. 
GitHub

Implementation notes

Keep all if: comparisons string‑based (== 'true'), because inputs are passed as strings in workflow_call. 
GitHub

References: reuse-agents.yml, agents-consumer.yml, agents-70-orchestrator.yml. 
GitHub
+2
GitHub
+2

4) Repair repo-health-self-check.yml permissions and make it actionable

Labels: workflows, devops, bug, enhancement, priority: medium, status: ready

Summary
The repo health workflow is invalid due to unsupported permissions (metadata, administration). Remove those and, if needed, use a PAT for branch‑protection queries. Ensure it posts a concise summary and fails only on true health regressions. 
GitHub
+1

Acceptance criteria

repo-health-self-check.yml validates and runs on schedule and workflow_dispatch.

No use of unsupported permissions scopes. Error message about “Unexpected value 'metadata'/'administration'” is gone. 
GitHub

If a privileged endpoint is required, the step uses secrets.SERVICE_BOT_PAT and clearly logs when PAT isn’t present.

The workflow produces a brief run summary in the step summary with actionable next steps.

Task list

 Remove metadata and administration from permissions:. 
GitHub

 Gate privileged API calls behind if: env.SERVICE_BOT_PAT != '' and use the PAT only in that step.

 Add a final summary step indicating pass/fail and what to fix.

Implementation notes

Keep the schedule reasonable (daily or weekly). Current runs show repeated failures due to invalid YAML rather than true health checks. 
GitHub

References: Workflow runs and the invalid permissions annotation. 
GitHub
+1

5) Rewire the failure tracker to listen to Gate and avoid duplicate noise

Labels: workflows, devops, ci, enhancement, priority: medium, status: ready

Summary
Point the failure tracker at workflow_run of Gate and unify its update path with the new consolidated maintenance workflow so PRs don’t get multiple bot comments. 
GitHub

Acceptance criteria

The failure tracker no longer triggers from PR 10 or PR 12.

On failures, the single “Maint Post‑CI” workflow updates the tracker Issue and the one PR comment; no other bot comments appear.

Label ci-failure is applied to the PR when appropriate. 
GitHub

Task list

 Update the tracker’s on: workflow_run: workflows: ["Gate"] types: [completed].

 Move tracker update logic into the consolidated maint-post-ci.yml pipeline (see Issue #2), leaving only a thin job in the tracker workflow if needed.

 Add ci-failure labeling in the consolidated workflow. 
GitHub

References: Actions list showing “Maint 33 Check Failure Tracker.” 
GitHub

6) Disable or restrict self‑test workflows to manual runs only

Labels: workflows, devops, refactor, priority: low, status: ready

Summary
The repo contains multiple self‑test workflows used to exercise reusable components. Keep them, but limit them to workflow_dispatch (and optional schedules) so they don’t clutter PRs. Examples:
maint-43-selftest-pr-comment.yml, maint-44-selftest-reusable-ci.yml, maint-48-selftest-reusable-ci.yml, pr-20-selftest-pr-comment.yml, selftest-pr-comment.yml, selftest-reusable-ci.yml. 
GitHub

Acceptance criteria

None of the listed self‑tests run on pull_request or general push.

Self‑tests can still be run manually via workflow_dispatch and, if desired, on a low‑frequency schedule.

Task list

 Remove pull_request triggers from the self‑test YAMLs.

 Optionally keep a weekly schedule trigger for drift detection.

References: Actions page listing these workflows. 
GitHub

7) Document the streamlined workflow topology

Labels: docs, documentation, workflows, priority: low, status: ready

Summary
Update CONTRIBUTING.md with a short section that shows the new topology:
PRs run Gate → consolidated Maint Post‑CI handles summary/autofix/tracker; agents orchestrated via agents-70-orchestrator.yml and agents-consumer.yml calling reuse-agents.yml. 
GitHub
+2
GitHub
+2

Acceptance criteria

CONTRIBUTING.md contains a “CI & Automation” section that:

names the required check (Gate / gate)

explains when the autofix runs and how to opt in/out

explains when agents automations run and which labels trigger bootstrapping

All file paths and workflow names match current repo.

Task list

 Add/refresh the “CI & Automation” section with links to the YAML files.

 Note that coverage and status are summarized in a single PR comment.
