1) PR checks (gate + CI)
Issue: Fix PR Gate and make it the single required check

Labels: ci, workflows, devops, priority: high, status: ready, testing

Summary
gate.yml is invalid today because it tries to use a YAML anchor inside a with: block and the runner treats the literal string as a value. Replace the anchor with a plain string, wire the gate to your reusable CI and docker smoke, and set concurrency so new pushes cancel stale runs. Context: error shows ‚ÄúUnexpected value 'not quarantine and not slow'‚Äù with the current file referencing .github/workflows/ci.yml and .github/workflows/docker.yml. 
GitHub

Acceptance Criteria

A single status named gate appears on PRs and is configured as ‚Äúrequired‚Äù in branch protection.

gate depends on:

core-tests-311 using .github/workflows/ci.yml with python: "3.11"

core-tests-312 using .github/workflows/ci.yml with python: "3.12"

docker-smoke using .github/workflows/docker.yml

Test marker argument is passed as a plain string, equivalent to the previous anchor value not quarantine and not slow.

Gate uses concurrency with cancel-in-progress: true keyed by PR number or ref name.

PRs that only touch docs and markdown skip heavy jobs.

Tasks

 Edit .github/workflows/gate.yml:

 Remove anchor _marker_filter and set marker: "not quarantine and not slow" directly in the with: for each CI job. 
GitHub

 Keep the three jobs (core-tests-311, core-tests-312, docker-smoke) as uses: ./.github/workflows/... and add a final gate job with needs pointing to all three. 
GitHub

 Add concurrency: { group: pr-${{ github.event.pull_request.number || github.ref_name }}-gate, cancel-in-progress: true }.

 Add on.pull_request.paths-ignore for doc‚Äëonly changes (e.g., **/*.md, docs/**, assets/**).

 In branch protection, require only the gate check.

Implementation Notes

Keep the reusable ci.yml as the source of truth for how tests are run; the gate is just orchestration.

If you need marker flexibility, make ci.yml accept an optional marker input and pass the literal string here.

Out of Scope

Changing test selection inside ci.yml itself.

Issue: Harden reusable CI to cover lint + types before tests

Labels: ci, workflows, enhancement, priority: medium, status: ready, testing

Summary
Fold ruff and mypy into the reusable CI so failures show up early without needing a separate workflow sprawl.

Acceptance Criteria

.github/workflows/ci.yml runs in this order: setup ‚Üí ruff (no‚Äëfix) ‚Üí mypy ‚Üí pytest.

Fail‚Äëfast on ruff/mypy. Test job does not start if static checks fail.

Cache is in place for pip (or uv) and pytest.

Tasks

 Update ci.yml to include ruff check --output-format github and mypy before pytest.

 Add actions/setup-python@v5 with caching for pip.

 Publish coverage artifact coverage-<py-version> for gate to consume.

Implementation Notes

Keep markers param as-is so gate can pass not quarantine and not slow.

2) Agents + Issue automation
Issue: Fix Agents (Consumer) workflow: reduce workflow_dispatch inputs to ‚â§ 10

Labels: agents, workflows, ci, bug, priority: high, status: ready

Summary
agents-consumer.yml fails to load because it defines more than 10 inputs on workflow_dispatch. GitHub enforces a hard limit of 10. Consolidate toggles into a single JSON input and parse inside the reusable workflow call. Context: error reads ‚Äúyou may only define up to 10 inputs for a workflow_dispatch event.‚Äù 
GitHub

Acceptance Criteria

agents-consumer.yml loads with no schema error and can run on dispatch.

Total workflow_dispatch.inputs count ‚â§ 10.

The job still calls reuse-agents.yml and passes all needed flags via a consolidated params_json (or similar).

Tasks

 In .github/workflows/agents-consumer.yml, replace the many boolean/string inputs with:

 params_json (string) that includes keys for enable_readiness, readiness_agents, custom_logins, require_all, enable_preflight, codex_user, codex_command_phrase, enable_verify_issue, verify_issue_number, enable_watchdog, bootstrap_issues_label, draft_pr.

 Parse params_json in the consumer job and map into with: for the reusable call (or map through inputs that the reusable workflow expects).

 Keep schedule as-is or set to a saner cadence if needed; ensure concurrency avoids parallel pile‚Äëups.

 Verify dispatch UI still exposes one params_json field (document a copy‚Äëpaste example).

Implementation Notes

The limit applies to workflow_dispatch only; your reusable workflow may still accept many workflow_call inputs. 
GitHub
+1

Issue: Repair reuse-agents.yml expressions and bootstrap step

Labels: agents, workflows, ci, bug, priority: high, status: ready

Summary
reuse-agents.yml is invalid due to a GitHub expression that concatenates JSON with + inside fromJSON(...). GitHub expressions don‚Äôt support + here; either output valid JSON upstream or use format. Context shows: ‚ÄúUnexpected symbol: '+'. Located at position 14 within expression: fromJSON('[' + steps.ready.outputs.issue_numbers + ']')[0].‚Äù 
GitHub
+1

Acceptance Criteria

reuse-agents.yml loads successfully; no expression errors.

The Bootstrap Codex PRs job correctly selects the first ready issue.

Readiness probe produces a Markdown table summary as before.

Tasks

 In the ‚ÄúFind Ready Issues‚Äù step, emit both:

 issue_numbers_json as a JSON array string via core.setOutput('issue_numbers_json', JSON.stringify(ready.map(r => r.number)))

 first_issue as a single number string.

 In the bootstrap step, use with: issue: ${{ steps.ready.outputs.first_issue }} or fromJSON(steps.ready.outputs.issue_numbers_json)[0].

 Quick audit: ensure all inputs (readiness_*, codex_*, etc.) default sanely and don‚Äôt require secrets to validate no‚Äëop paths.

Implementation Notes

Keep the watchdog and verification jobs; they‚Äôre useful when enabled. Errors in this file are blocking runs at the moment. 
GitHub

3) Routine repository maintenance
Issue: Fix Repository Health Self‚ÄëCheck workflow permissions and make it degrade gracefully

Labels: devops, workflows, infra, priority: medium, status: ready

Summary
repo-health-self-check.yml requests permissions.administration: read, which is not a valid top‚Äëlevel permission and causes the file to be invalid. Replace with supported scopes and handle branch protection checks with best‚Äëeffort fallbacks. Context error: ‚ÄúUnexpected value 'administration'‚Äù at permissions. 
GitHub

Acceptance Criteria

Workflow loads and runs on schedule (cron) and on dispatch.

If branch‚Äëprotection API calls fail due to insufficient permissions, the job adds a warning but does not fail the run solely for that reason.

When any check fails (missing labels, PAT absent, etc.), a single open issue titled [health] repository self-check failed is created or updated with details.

Tasks

 Remove permissions.administration. Keep contents: read, issues: write. 
GitHub

 In the branch‚Äëprotection step, catch 403 and set an output like protection_issue="Unable to verify..."

 Aggregate step composes failure reasons and emits one multi‚Äëline output.

 Issue writer either updates the existing failure issue or creates one if none open.

Implementation Notes

Presently the job probes missing labels and SERVICE_BOT_PAT; keep that logic intact. 
GitHub

Issue: Consolidate/retire self‚Äëtest workflows into docs

Labels: workflows, devops, documentation, priority: low, status: ready

Summary
There are multiple ‚Äúselftest‚Äù workflows that exist primarily to validate reusable constructs and documentation. They‚Äôve served their purpose and now create noise and failure history. Migrate them to /docs/ci with snippets and keep only one optional ‚Äúreusable selftest‚Äù as a proving ground.

Acceptance Criteria

The following are archived or removed from active runs:

maint-43-selftest-pr-comment.yml

maint-44-selftest-reusable-ci.yml

maint-48-selftest-reusable-ci.yml

maint-90-selftest.yml

pr-20-selftest-pr-comment.yml

Keep a single, fixed ‚Äúreusable selftest‚Äù if you want, but in valid form (see next issue).

ARCHIVE_WORKFLOWS.md references where these landed. 
GitHub
+1

Tasks

 Move the files into Old/ or remove them; link their intent in docs/ci/WORKFLOWS.md.

 Close any open Issues tracking those experiments.

Implementation Notes

Reduces clutter in Actions and prevents ‚Äúalways red‚Äù pages that hide real regressions. 
GitHub

4) Make the self‚Äëtest actually valid (optional but useful)
Issue: Rewrite reusable-99-selftest.yml to use jobs.<id>.uses instead of step-level uses

Labels: workflows, ci, enhancement, priority: medium, status: ready

Summary
Today this file calls a reusable workflow from within steps, which Actions rejects. It must be referenced as jobs.<id>.uses. Context error: ‚Äúreusable workflows should be referenced at the top-level jobs.*.uses key, not within steps.‚Äù 
GitHub

Acceptance Criteria

The selftest workflow runs, iterating a small scenario matrix that calls .github/workflows/reusable-90-ci-python.yml via jobs.scenario.uses: ....

The aggregate job publishes a succinct summary and verifies expected artifacts.

Tasks

 Convert the current steps: - uses: stranske/Trend_Model_Project/.github/workflows/reusable-90-ci-python.yml@... into jobs.scenario.uses: ... with strategy.matrix.include for the scenarios. 
GitHub

 Wire needs: [scenario] into the aggregate job and adjust outputs accordingly.

Implementation Notes

Keep this file opt‚Äëin; don‚Äôt have it run on every push. Trigger by dispatch or by label if you want.

5) Error‚Äëchecking automation with autofix
Issue: Add lightweight autofix workflow for formatting and trivial lint

Labels: workflows, ci, autofix, priority: medium, status: ready

Summary
Low‚Äërisk, high‚Äësignal: run ruff format and a constrained ruff --fix on PR branches, then, if changes are present, push a bot‚Äëauthored commit or open a small ‚Äúautofix‚Äù PR with labels. This reduces the churn during reviews while keeping the main CI strict.

Acceptance Criteria

A workflow named autofix runs on pull_request and tries:

ruff format and ruff --fix on safe rules only (e.g., F401, F841, E/W series you‚Äôre comfortable with).

If diffs exist, commit back to the branch (if allowed) or open a PR labeled autofix + autofix:applied.

Main CI still runs ruff check non‚Äëfixing and fails on violations.

Tasks

 Create .github/workflows/autofix.yml with guarded permissions (contents: write for PRs from same repo).

 Add labels autofix, autofix:applied, autofix:clean, autofix:debt on the generated PRs per outcome (labels already exist). 
GitHub

 Document the ‚Äúwhat it will and won‚Äôt change‚Äù in CONTRIBUTING.md.

Implementation Notes

Keep the rule set conservative to avoid surprise edits.

6) Error‚Äëchecking: cosmetic test repair mode
Issue: Add ‚Äúcosmetic test repairs‚Äù job for flaky or tolerance nits

Labels: testing, ci, workflows, priority: low, status: ready

Summary
For tests that only fail on formatting/tolerance/seed drift, provide a manual dispatch that can open a PR with small, mechanical adjustments. This keeps mainline CI strict but gives you a button for acknowledged nits.

Acceptance Criteria

A workflow_dispatch job runs pytest -q with a small script that:

Detects common flakes or expected numeric tolerance tweaks.

Writes a minimal patch under a guard comment, then opens a PR tagged testing, autofix:applied on a branch.

Tasks

 Create .github/workflows/cosmetic-repair.yml with permissions: contents: write, pull-requests: write.

 Add a small scripts/ci_cosmetic_repair.py to propose diffs for strictly enumerated cases.

Implementation Notes

Keep this dispatch‚Äëonly; never on push or PR by default.

7) Agents watch + bootstrap quality of life
Issue: Make the Agents consumer run safely on a schedule

Labels: agents, workflows, devops, priority: medium, status: ready

Summary
Hourly runs can stack if previous runs are still going. Add concurrency, short timeouts, and an opt‚Äëin set of probes.

Acceptance Criteria

agents-consumer.yml uses concurrency: { group: agents-consumer, cancel-in-progress: true }.

Each job has timeout-minutes set.

Default behavior is minimal: watchdog and readiness only, with preflight and bootstrap gated by params_json.

Tasks

 Add concurrency to the workflow root.

 Apply timeout-minutes to each job.

 Make README note that bootstrap runs are opt‚Äëin via params_json.

Context

Current file calls into reuse-agents.yml. Fixes in the previous issues will make this usable again. 
GitHub
+1

8) Docs and audit trail
Issue: Publish a concise CI/Agents workflow catalog

Labels: documentation, workflows, priority: low, status: ready

Summary
You already have CI docs and an archive marker. Consolidate a short ‚Äúcatalog‚Äù with purpose, triggers, and the expected status they post. Link from README for contributor sanity. Existing doc touch points: ARCHIVE_WORKFLOWS.md and your CI docs commits. 
GitHub
+1

Acceptance Criteria

docs/ci/WORKFLOWS.md lists: Gate, CI, Docker smoke, Autofix, Repo Health, Agents Consumer, Reuse‚Äëagents.

Each entry includes:

What it does

When it runs

Required secrets/permissions

What status/labels it sets

Tasks

 Write/update docs/ci/WORKFLOWS.md.

 Link it from README.md.

9) Optional: doc‚Äëonly short‚Äëcircuit job
Issue: Add quick doc‚Äëonly CI to comment on PRs

Labels: workflows, documentation, ci, priority: low, status: ready

Summary
When only docs change, run a fast job that posts a friendly PR comment that heavy tests were skipped by design. Saves people from scrolling through the Actions tab to understand why nothing ran.

Acceptance Criteria

A job named docs-only runs when only **/*.md, docs/**, assets/** change.

It writes a single PR comment: ‚ÄúDoc‚Äëonly change detected; gate skipped by path filters.‚Äù

Tasks

 Add a small workflow with if: "github.event_name == 'pull_request'" and paths filters, using actions/github-script@v7 to comment.

10) Optional: coverage trend artifact and soft gate
Issue: Add coverage trend artifact and soft alert

Labels: testing, tech:coverage, ci, priority: low, status: ready

Summary
Keep strong gating on tests, but surface a ‚Äúsoft‚Äù alert if coverage drops beyond a threshold. This keeps PRs moving but nudges contributors.

Acceptance Criteria

Reusable CI uploads coverage-summary artifact and writes a trend line to the job summary.

If coverage falls more than X points from baseline, post a PR comment with a üî∂ warning; do not fail the job.

Tasks

 Add a short Python step to parse coverage XML and compare with a stored baseline file in the repo.

 Post the message via actions/github-script@v7.

11) Optional: agent assignment verification on issues
Issue: Verify agent assignment when label agent:codex is present

Labels: agents, workflows, priority: low, status: ready

Summary
reuse-agents.yml already includes an ‚ÄúVerify Agent Issue Assignment‚Äù job. Make it a reusable, dispatchable check to sanity‚Äëcheck that issues tagged agent:codex have an agent assignee. 
GitHub

Acceptance Criteria

Dispatch input: issue_number.

Fails with a clear message if neither copilot nor chatgpt-codex-connector is assigned.

Writes a brief summary table.

Tasks

 Factor the verification step into its own small workflow (or keep as a job inside reuse-agents.yml but expose a dispatch path).

 Keep permissions to issues: read.

12) Final sweep: make PR ‚Äúgate‚Äù the only thing reviewers care about
Issue: Audit required checks and remove legacy required statuses

Labels: devops, workflows, priority: medium, status: ready

Summary
Once the gate is fixed, set branch protection to require only gate so the PR experience stops looking like Times Square.

Acceptance Criteria

Branch protection on phase-2-dev requires only gate.

Old required contexts (if any) are removed.

Tasks

 Update branch protection.

 Note the change in CHANGELOG.md.
