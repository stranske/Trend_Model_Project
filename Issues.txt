1) Consolidate autofix lanes into a single autofix.yml

Suggested labels: workflows, devops, refactor, risk:low, priority: high, agent:codex

Why
Two separate autofixers compete and occasionally collide. One lane is enough: fewer races, fewer surprise pushes.

Scope

Create a single autofix.yml triggered by workflow_run on your CI workflow.

Inside, add two jobs guarded by light heuristics:

small-fixes: run formatters/linters/type-hygiene on PRs under a size threshold and limited globs.

fix-failing-checks: only if failing checks are from the “trivial” set (lint/format/type), then patch and push.

Tasks

 Remove or archive the redundant autofix workflow(s) (commit to Old/ or Old/.github/workflows).

 Implement commit prefix chore(autofix): and a loop guard that skips when the last commit starts with that prefix.

 Push with the service bot PAT (not GITHUB_ACTIONS token) to avoid branch‑protection weirdness.

Acceptance criteria

Only one autofix workflow remains.

Autofix runs once per PR, never self‑loops.

PRs show a single, clear autofix commit when eligible.

2) Merge policy: replace “auto‑approve” and “automerge minor” with one merge-manager.yml

Suggested labels: workflows, devops, automerge, config, risk:low, priority: high, agent:codex

Why
Approval and auto‑merge logic lives in two places and fails too often. One policy brain is easier to reason about.

Scope

One workflow that:

Auto‑approves when diffs are small and safe (docs/tests/format‑only).

Enables auto‑merge when the gate is green and the PR has automerge.

Leaves a single explanatory comment if it declines.

Tasks

 Remove the legacy auto‑approve workflow after parity is reached.

 Ensure pull-requests: write and contents: write permissions for the job that toggles auto‑merge.

 Respect CODEOWNERS, don’t self‑approve author PRs.

Acceptance criteria

One workflow controls approval and auto‑merge decisions.

Safe PRs merge without human clicks; others get a single, clear rationale comment.

3) Branch protection alignment: make the gate the only required check (when ready)

Suggested labels: workflows, config, risk:low, priority: high, agent:codex

Why
“Required: CI: missing” happens when protection expects a name your jobs no longer produce. The gate should be the single source of truth.

Scope

Keep your gate job as the canonical pass/fail.

Update branch protection to require only gate / all-required-green.

Optionally keep a thin CI wrapper until you flip to gate.

Tasks

 Confirm gate job name is stable.

 Update protection rules to require only the gate.

 Remove any stale required checks (like CI) once the switch is verified.

Acceptance criteria

PRs show exactly one required status for merge.

No more “Required: CI: missing” banners.

4) Coverage soft‑gate: file/update a single “Increase test coverage” issue instead of failing PRs

Suggested labels: testing, tech:coverage, workflows, risk:low, priority:medium, agent:codex

Why
Blocking merges for coverage is noisy. Better: always capture the hotspots and create/update one tracking issue.

Scope

Tests still produce coverage.json|xml|html and JUnit.

A coverage_soft_gate job runs always(), computes average/worst coverage, lists bottom ~15 files, and updates a single open issue titled “Increase test coverage (soft gate).”

Append the same summary to the PR run summary.

Tasks

 Ensure each test matrix job uploads coverage.json, coverage.xml, htmlcov/**, pytest-report.xml.

 Implement a soft‑gate job to download artifacts, compute the table, and upsert the issue labeled tech:coverage.

 Set artifact retention (e.g., 10 days).

Acceptance criteria

PRs don’t fail on coverage; a single open coverage issue gets updated with each run.

The PR summary includes a coverage section with hotspots.

5) PR summary: add authoritative table with per‑job log links

Suggested labels: workflows, devops, risk:low, priority:medium, agent:codex

Why
Sometimes jobs are missing from your current summary. Use the Actions API for the current run and link each job’s logs directly.

Scope

In the CI (or gate) workflow, after dependencies complete, enumerate jobs for the current run and write: Job | Result | [logs].

Tasks

 Add a github-script step calling actions.listJobsForWorkflowRun and write a markdown table to $GITHUB_STEP_SUMMARY.

 Include matrix jobs as separate rows.

Acceptance criteria

Every CI run shows a complete log table; failures deep‑link to the correct page.

6) Agents: collapse to assign-to-agents.yml + agent-watchdog.yml; archive overlapping helpers

Suggested labels: workflows, devops, refactor, risk:low, priority: high, agent:codex

Why
Multiple helper workflows (labelers/consumers) overlap. Keep one assigner and one watcher for clarity.

Scope

Keep:

assign-to-agents.yml: map agent:* labels to Copilot/Codex, assign, and post the connector’s trigger comment as designed.

agent-watchdog.yml: watch issue timeline for cross‑referenced PR; post a diagnostic if none appears in time.

Archive other agent sidecars once these two cover behavior.

Tasks

 Confirm the assigner handles Issues and PRs, and that it posts the correct start commands per agent policy.

 Set a short, sane watchdog timeout (e.g., 5–10 min) and a clear timeout comment.

 Move archived YAMLs to Old/.github/workflows (or delete) after parity test.

Acceptance criteria

Labeling an issue agent:codex creates a branch and PR, and posts the trigger command.

The watchdog reports success (linked PR) or a precise failure message.

7) Single autofix guard and policy

Suggested labels: workflows, devops, risk:low, priority:medium, agent:codex

Why
Autofix loops happen when bots edit and re‑trigger themselves.

Scope

Standardize on a commit prefix and guard logic across all autofix steps.

Tasks

 Prefix: chore(autofix):.

 Guard: if github.actor == 'github-actions' and last commit starts with that prefix, skip.

 Document in .github/workflows/README.md.

Acceptance criteria

No self‑trigger storms; audit logs show the guard firing when expected.

8) Failure → Issue routing: centralize in check-failure-tracker

Suggested labels: workflows, devops, risk:low, priority: medium, agent:codex

Why
Scattered “file an issue on failure” logic creates duplicates.

Scope

One tracker workflow owns opening/updating issues for repeatable failures.

Deduplicate by signature (workflow name + job + top stack line).

Tasks

 Normalize issue titles and labels (e.g., workflows, devops, priority: medium).

 Update body with run links and the per‑job log table.

 Ensure it never creates more than one open issue per signature.

Acceptance criteria

Recurrent failures update the same issue with fresh context; no duplicates.

9) Docker smoke reliability: buildx cache + timeout

Suggested labels: workflows, devops, risk:low, priority:medium, agent:codex

Why
Pulls and cache misses cause flaky timeouts. Buildx caching and a cap keeps the lane predictable.

Scope

Use buildx with cache keyed on Dockerfile + requirements.lock.

Always --pull and add timeout-minutes: 10 to the smoke job.

Tasks

 Set up actions/cache for the buildx cache dir.

 Log cache hits/misses to the summary.

Acceptance criteria

Smoke job completes under 10 minutes on repeat runs with visible cache hits.

10) Coverage artifact naming + retention

Suggested labels: testing, tech:coverage, workflows, risk:low, priority: low, agent:codex

Why
The soft‑gate depends on predictable artifacts.

Scope

Normalize artifact names to coverage-<python-version> and set retention-days (e.g., 10).

Tasks

 Upload coverage.json, coverage.xml, htmlcov/**, pytest-report.xml consistently across the matrix.

 Set retention on upload-artifact.

Acceptance criteria

Soft‑gate job finds artifacts without branching logic.

11) Bulk create Issues workflow (paste markdown → Issues)

Suggested labels: workflows, docs, risk:low, priority: low, agent:codex

Why
You often seed a backlog. This turns one paste into multiple formatted issues.

Scope

workflow_dispatch that parses a markdown input where each issue starts with ## Title, optional Labels: line, then body.

Creates issues and applies labels; supports extra default labels.

Tasks

 Add .github/workflows/bulk-issues.yml with parser + creator.

 Document a short example in README.

Acceptance criteria

A single run creates multiple correct issues from a pasted spec.

12) Update CODEOWNERS to current tree

Suggested labels: docs, config, risk:low, priority: medium, agent:codex

Why
Ownership needs to match today’s paths so reviews and auto‑merge rules behave.

Scope

Ensure patterns for src/**, tests/**, .github/**, agents/**, streamlit_app/** map to the right owners.

Tasks

 Generate and review a proposed CODEOWNERS.

 Open a PR and verify that review requests route to expected owners.

Acceptance criteria

PRs request the correct owners; small lanes can auto‑merge after approval.

13) Repo health nightly (lightweight)

Suggested labels: workflows, devops, docs, risk:low, priority: low, agent:codex

Why
A tiny nightly pass catches configuration drift without enterprise bloat.

Scope

Nightly workflow that runs:

Workflow lint (e.g., actionlint)

Sanity check for required labels (agent:*, priority:*, workflows, tech:coverage)

Optional ping if critical secrets/vars are missing

Tasks

 Add nightly schedule.

 On failure, update a single “Ops” issue with details and links.

Acceptance criteria

Nightly runs produce a green “OK” or update the single health issue with clear actions.
