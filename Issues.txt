1) Config schema validation with minimal friction
Labels: agents, agent:codex, config, enhancement, testing
GUID: TMP-2025-11-16-CONFIG-SCHEMA

Why:
Typos in config keys or wrong types cascade into runtime explosions.

Tasks:
- Define a lightweight config schema for core knobs: data paths, universe file, frequency, costs.
- Validate on startup; include defaults and helpful error texts.
- Add tests covering missing required fields and wrong types.

Acceptance criteria:
- Invalid configs fail fast with a single, clear error.
- Valid configs round-trip through load/validate.

Implementation notes:
- Prefer stdlib/dataclasses + manual checks to avoid adding heavy deps.
- Keep schema in a single file used by CLI/app.

------------------------------------------------------------

2) Positions contract: single canonical structure between signals and portfolio
Labels: agents, agent:codex, engine, enhancement, testing
GUID: TMP-2025-11-16-POSITIONS-CONTRACT

Why:
Mismatched expectations about shapes/units of positions lead to mis-weights and odd fills.

Tasks:
- Define the positions contract: index is Date; columns are symbols; values are target weights in [-1, 1] or NaN for not held.
- Provide `normalize_positions(df)` to enforce bounds, fill NaN with 0, and mask non-eligible assets.
- Add tests for overweight, underweight, and NaN handling.

Acceptance criteria:
- Portfolio layer accepts only normalized positions; rejects invalid shapes with helpful errors.
- Tests show reproducible final weights for a simple two-asset toy case.

Implementation notes:
- Document the contract beside the function and reference it in errors.

------------------------------------------------------------

3) Run manifest + quick HTML report for reproducibility
Labels: agents, agent:codex, exports, enhancement, docs
GUID: TMP-2025-11-16-RUN-MANIFEST

Why:
You need a durable breadcrumb of “what ran, with what, and when,” plus a one-pager to eyeball results.

Tasks:
- Emit a small JSON “manifest” per run: config hash, code commit (if available), data date range, instrument count, basic metrics.
- Generate a minimalist HTML report with key charts/metrics and links to artifacts.
- Save both alongside outputs in a timestamped directory.

Acceptance criteria:
- Each run leaves a manifest and HTML that can be opened standalone.
- Manifests include enough metadata to rerun the job.

Implementation notes:
- Keep HTML extremely simple; avoid heavy templating. Inline CSS is fine.

------------------------------------------------------------

4) Critical invariant tests: data, universe, rebalance, no-lookahead, costs
Labels: agents, agent:codex, testing, engine, data
GUID: TMP-2025-11-16-INVARIANT-TESTS

Why:
A small battery of invariants catches 90% of regressions.

Tasks:
- Test that missing/extra columns raise validation errors.
- Test that non-members are excluded at rebalance.
- Test that rolling helper never uses future data.
- Test that costs reduce returns by the analytical amount on a toy turnover sequence.
- Test that rebalance dates occur only on the calendar utility’s dates.

Acceptance criteria:
- Five named tests pass; failures point to the exact invariant that broke.

Implementation notes:
- Keep fixtures tiny and inline to ensure legibility.

------------------------------------------------------------

5) Performance quick win: avoid duplicate groupby/apply and cache intermediate features
Labels: agents, agent:codex, engine, enhancement
GUID: TMP-2025-11-16-PERF-CACHE

Why:
Recomputing identical features inflates runtime. Small caching plus vectorization trims cycles.

Tasks:
- Identify top 2–3 repeated computations in signals and wrap them with a simple memo (`lru_cache` or dict keyed by params).
- Replace slow `groupby.apply` with vectorized ops where feasible.
- Add a one-line timing logger around key stages to verify improvement.

Acceptance criteria:
- On a medium sample dataset, end-to-end runtime improves meaningfully without altering results.
- Timing logs show cached stages shrinking materially on successive runs.

Implementation notes:
- Keep caching in-process and ephemeral; no disk persistence required.

------------------------------------------------------------

6) Packaging hygiene: exclude `Old/` and `retired/` from imports and builds
Labels: agents, agent:codex, backend, config
GUID: TMP-2025-11-16-PKG-EXCLUDES

Why:
Legacy directories bleeding into imports is a haunted-house problem.

Tasks:
- Ensure `pyproject.toml` or equivalent excludes `Old/` and `retired/` from the package.
- Add a sanity test that importing the package does not expose modules from those paths.

Acceptance criteria:
- Editable install shows no imports resolved from excluded folders.
- CI import sanity check passes.

Implementation notes:
- If needed, add `MANIFEST.in` excludes for sdist.

------------------------------------------------------------

7) Minimal CI: install, import, and run invariant tests
Labels: agents, agent:codex, ci, devops, testing
GUID: TMP-2025-11-16-CI-SMOKE

Why:
A tiny CI sweep prevents “it runs on my laptop” surprises.

Scope:
- Minimal CI: install, import, and run invariant tests.

Tasks:
- Add a workflow that sets up Python, installs the project, and runs the invariant tests from issue 11.
- Run an import sanity check for the package.
- Cache dependencies between runs to keep it fast.

Acceptance criteria:
- Workflow is green on default branch and PRs.
- Failures surface with actionable logs.

Implementation notes:
- Keep matrix minimal (one Python version).
- Don’t enforce coverage thresholds; keep it lightweight.
