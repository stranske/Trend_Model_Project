1. Autofix (Option B): loop runs on autofix/autofix:clean without agent:*; remove Gate’s embedded autofix to avoid duplicates

Labels: agent:codex, autofix, ci, devops, automation, enhancement

Why
Right now there are two autofix paths:

Gate contains an embedded autofix job;

A separate CI Autofix Loop workflow runs after Gate failures.

The loop still expects an agent:* label, which blocks quick, human PR cleanups. Choose Option B: keep the loop, make it run on autofix or autofix:clean alone, and remove Gate’s embedded autofix job to avoid double‑runs. This aligns the user experience and cuts noise.

Consistent, label‑driven flow that works for humans and agents.

Single source of truth for autofix behavior; fewer edge cases.

Scope

Update .github/workflows/autofix.yml to run on autofix or autofix:clean without requiring any agent:* label.

Remove or hard‑disable Gate’s internal autofix job while keeping Gate’s summary behavior (auto‑applying autofix:clean for cosmetic‑only failures, commenting status).

Preserve strict edit scope to Python files only.

Non‑Goals

Changing ruff/black/mypy rules.

Letting autofix touch non‑Python files.

Tasks

- In autofix.yml, delete any hasAgent checks or co‑label gates; trigger on autofix or autofix:clean only.

- Keep ALLOWED_GLOBS limited to **/*.py and **/*.pyi.

- Remove or guard‑disable the autofix job inside Gate; keep Gate’s summary that detects cosmetic‑only failures and applies autofix:clean.

- After a successful push by the loop, remove the autofix/autofix:clean label so we don’t re‑trigger endlessly.

- Verify behavior on a test PR with only import/format errors; attach the before/after Gate summary screenshot.

Acceptance criteria

- A PR labeled autofix or autofix:clean triggers the loop even without any agent:* label.

- Gate no longer runs its own autofix job, but still comments and labels as before.

- Only Python files are modified; loop exits cleanly when nothing to change.

Implementation notes

Files: .github/workflows/autofix.yml, .github/workflows/pr-00-gate.yml, any helper scripts referenced by Gate’s summary.
PR title prefix: [CI][Autofix] Option B
PR kickoff comment (to paste after opening PR):
@{agent} Apply Option B: enable the standalone autofix loop for 'autofix*' labels without requiring any 'agent:*' label; remove Gate's autofix job; keep Gate's summary/label behavior; ensure only Python files are edited; remove 'autofix*' labels after success.

2. Agents 63: pick the canonical entrypoint (Issue Intake or agent‑specific wrappers) and retire the other

Labels: agent:codex, agents, devops, automation, docs, enhancement

Why

You have Agents 63 Issue Intake plus agent‑specific wrappers like Agents 63 Codex Issue Bridge. Intake currently shows no runs, while the Codex wrapper is active. Decide the one entrypoint and remove the other to reduce surface area and “which button do I press?” confusion.

One obvious path avoids mis‑triggers, reduces maintenance, and makes Orchestrator routing simpler.

Scope

Pick the canonical workflow:

If Intake wins: add the same triggers used by the Codex wrapper and internally call the reusable bridge; deprecate wrappers.

If the Codex wrapper wins: delete Intake or move it to an archive folder and update docs.

Non‑Goals

Changing agent logic, labels, or orchestration.

Tasks

- Decide the canonical entrypoint and document it in docs/ci/AGENTS_POLICY.md.

- Either wire Intake with the correct issues:/labels: triggers and a workflow_dispatch input set, or remove it entirely.

- Remove the non‑canonical workflow from .github/workflows/ to prevent accidental runs.

- Validate on a test issue labeled agent:codex that the expected flow runs and produces a PR.

Acceptance criteria

- Only one “front‑door” workflow is visible in Actions for creating agent‑driven issues.

- Labeling an issue with agent:codex results in the expected pipeline run and PR creation.

Implementation notes

Files: .github/workflows/agents-63-issue-intake.yml, .github/workflows/agents-63-codex-issue-bridge.yml, related docs.
PR title prefix: [Agents] Canonical entrypoint
PR kickoff comment:
@{agent} Keep only one agents entrypoint. Implement the chosen path, remove the other, and verify a labeled issue flows to a PR via the orchestrator.

4. Agents PR meta: add short /codex run alias for the long comment command

Labels: agent:codex, agents, devops, enhancement, guardrail

Why

The merged PR meta manager expects a long, exact command string to start or update agent work. Humans typo; shocker. Add a short alias like /codex run that maps to the same behavior as the long form so contributors don’t have to copy a paragraph to poke the robot.

Fewer fat‑fingered no‑ops, less comment thrash, smoother agent dispatch.

Scope

Add a simple alias parser in the comment‑listener step that treats /codex run (and optionally /agent run) as equivalent to the long @{agent} ... command.

Keep the “exactly one agent:* label” rule intact; improve error messaging when multiple agents are labeled.

Non‑Goals

Changing agent label semantics or PR body markers.

Tasks

- Extend the actions/github-script listener to route /codex run to the existing command path.

- If multiple agent:* labels exist, post a single actionable comment listing them and instruction to remove extras.

- Validate on a test PR that /codex run updates the PR body marker section and dispatches work exactly like the long form.

Acceptance criteria

- /codex run comment starts the same agent flow as the long command.

- Conflicting labels produce a clear, single error comment with guidance.

Implementation notes

Files: .github/workflows/agents-pr-meta-manager.yml
PR title prefix: [Agents] PR command alias
PR kickoff comment:
@{agent} Add a '/codex run' alias in the PR meta manager and keep the one-agent-label rule with clear errors on conflicts.

5. Agents 63 Intake: add the correct triggers and concurrency to match the active Codex wrapper

Labels: agent:codex, agents, devops, automation, docs
Why

If you choose Issue Intake as the canonical entrypoint (see Issue 2), it needs the same event wiring the Codex Issue Bridge already has. Right now Intake shows no runs, so its triggers likely don’t match your flow.

No triggers, no runs. No runs, no robots.

Scope

Mirror the wrapper’s on: issues label‑based triggers and workflow_dispatch inputs.

Add a simple concurrency key to prevent double‑processing if labels churn.

Non‑Goals

Changing how the reusable bridge works.

Tasks

- Add on: issues for labeled/unlabeled events with filters for agent:codex.

- Add workflow_dispatch with inputs {source, raw_input, source_url} matching current bridge expectations.

- Add concurrency: group: issue-${{ github.event.issue.number }}-intake, cancel-in-progress: true.

- Test on a sandbox issue and confirm a single intake run happens per label add/remove.

Acceptance criteria

- Intake reliably triggers when an issue is labeled agent:codex and does not double‑process during label churn.

- The Codex bridge receives normalized inputs from Intake and creates a PR.

Implementation notes

Files: .github/workflows/agents-63-issue-intake.yml
PR title prefix: [Agents] Intake wiring
PR kickoff comment:
@{agent} Add the correct triggers and concurrency to Agents 63 Intake so it mirrors the Codex wrapper behavior without double-processing.

6. Health guards: update branch filters so protections apply if default branch changes

Labels: agent:codex, devops, guardrail, config, documentation

Why

Some health and guard workflows use explicit phase-2-dev branch filters. If the default branch ever changes, those protections go dark. Since triggers can’t read default_branch dynamically, list both likely branches and document the expectation in CI docs. Example: CI Signature Guard currently targets phase-2-dev.

Prevents “oops, we renamed the default branch and the guard stopped firing” headaches.

Scope

Add main alongside phase-2-dev in the on: filters for relevant Health/Guard workflows.

Note the convention in docs/ci/ so future renames consider CI updates.

Non‑Goals

Changing job logic, only the triggers and docs.

Tasks

- Update branch lists in Health/Guard workflows to include both branches.

- Add a short note in docs/ci/BRANCHING.md about keeping CI triggers aligned with the default branch.

- Validate the triggers by pushing a no‑op change to workflow files on both branches (or using workflow_dispatch).

Acceptance criteria

- Health/Guard workflows trigger on both phase-2-dev and main.

- Docs explain the requirement to keep triggers aligned on default branch changes.

Implementation notes

Files: ./github/workflows/health-43-ci-signature-guard.yml and any other guard with a branch filter.
PR title prefix: [Health] Branch filter hardening
PR kickoff comment:
@{agent} Add main alongside phase-2-dev in guard workflow triggers and document the default-branch expectation.

7. Actions security: pin third‑party actions by commit SHA across Gate/Health/Agents

Labels: agent:codex, devops, guardrail, enhancement
Why

Most steps reference actions by major tag (@v4, @v5). Pinning third‑party actions by commit SHA is a low‑noise, high‑value supply‑chain hardening. Start with Gate, branch‑protection checks, and PR meta manager.

Prevents surprise behavior if an upstream tag moves.

Scope

Replace tags for non‑first‑party actions with exact SHAs; optionally pin actions/* too if you want full determinism.

Add a short doc note and a tiny script/snippet to bump SHAs when needed.

Non‑Goals

Changing workflows’ logic.

Tasks

- Enumerate all actions in Gate, Health 44, Agents PR meta; identify non‑actions/*.

- Pin them by SHA; record SHAs in comments.

- Add docs/ci/ACTIONS_PINNING.md with a one‑pager on updating pins.

- Validate by re‑running Gate and Health Sweep on a dummy PR.

Acceptance criteria

- All non‑first‑party actions are pinned by SHA; runs remain green.

- Docs exist for updating pins.

Implementation notes

Files: affected .github/workflows/*.yml; new docs/ci/ACTIONS_PINNING.md.
PR title prefix: [Security] Pin actions
PR kickoff comment:
@{agent} Pin third-party actions by SHA across Gate/Health/Agents and add a short doc explaining how to bump pins.
