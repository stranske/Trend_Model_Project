name: PR 10 CI Python

on:
  workflow_call:
    inputs:
      python-version:
        description: Python version to run under
        required: false
        default: "3.11"
        type: string
      marker:
        description: Optional pytest marker expression
        required: false
        default: ""
        type: string
      coverage-min:
        description: Minimum coverage percentage required
        required: false
        default: "70"
        type: string
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    paths-ignore:
      - "docs/**"
      - "**/*.md"
      - ".github/ISSUE_TEMPLATE/**"
  push:
    branches: [phase-2-dev]
    paths-ignore:
      - "docs/**"
      - "**/*.md"
      - ".github/ISSUE_TEMPLATE/**"
  workflow_dispatch:
    inputs:
      python-version:
        description: Python version to run under
        required: false
        default: "3.11"
        type: choice
        options: ["3.11", "3.12"]
      marker:
        description: Optional pytest marker expression
        required: false
        default: ""
        type: string
      coverage-min:
        description: Minimum coverage percentage required
        required: false
        default: "70"
        type: string

concurrency:
  group: ci-${{ github.ref }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true

jobs:
  python:
    name: ci / python
    uses: ./.github/workflows/reusable-96-ci-lite.yml
    with:
      python-version: ${{ inputs['python-version'] || '3.11' }}
      marker: ${{ inputs.marker || '' }}
      coverage-min: ${{ inputs['coverage-min'] || '70' }}
