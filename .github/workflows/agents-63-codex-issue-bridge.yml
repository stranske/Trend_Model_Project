# See docs/ci/AGENTS_POLICY.md for guardrails and override process.
name: Agents 63 Codex Issue Bridge

on:
  issues:
    types: [opened, labeled, reopened]
  workflow_dispatch:
    inputs:
      test_issue:
        description: "Manually test with a specific issue number (optional)"
        required: false
        default: ""
      post_codex_comment:
        description: "Auto-post '@codex start' as the actor (true/false)"
        required: false
        default: "true"
      pr_mode:
        description: "create | invite (invite = human opens the PR)"
        required: false
        default: "create"
      codex_pr_draft:
        description: "Force created PR to be draft (true/false)"
        required: false
        default: "false"

permissions:
  contents: write
  pull-requests: write
  issues: write

concurrency:
  group: codex-issue-${{ github.event.issue.number || inputs.test_issue || github.run_id }}
  cancel-in-progress: true

jobs:
  bridge:
    uses: ./.github/workflows/reusable-agents-issue-bridge.yml
    # Resolve keepalive opt-in is delegated to the reusable bridge workflow.
  # Dispatch Agents Orchestrator (keepalive sync) remains part of the reusable bridge so
  # agent:codex label transitions automatically propagate `### Keepalive:` summaries while
  # forwarding keepalive params_json payloads to agents-70-orchestrator.yml.
    with:
      agent: codex
      agent_display_name: Codex
      agent_command: '@codex start'
      plan_and_execute_command: '@codex plan-and-execute'
      issue_manual_input: ${{ inputs.test_issue }}
      pr_mode_input: ${{ inputs.pr_mode }}
      draft_flag_input: ${{ inputs.codex_pr_draft }}
      post_agent_comment_input: ${{ inputs.post_codex_comment }}
      source_workflow_file: agents-63-codex-issue-bridge.yml
    secrets: inherit
