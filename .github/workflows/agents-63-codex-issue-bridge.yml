# See docs/ci/AGENTS_POLICY.md for guardrails and override process.
name: Agents 63 Codex Issue Bridge

on:
  issues:
    types: [opened, labeled, reopened]
  workflow_dispatch:
    inputs:
      test_issue:
        description: "Manually test with a specific issue number (optional)"
        required: false
        default: ""
      post_codex_comment:
        description: "Auto-post '@codex start' as the actor (true/false)"
        required: false
        default: "true"
      pr_mode:
        description: "create | invite (invite = human opens the PR)"
        required: false
        default: "create"
      codex_pr_draft:
        description: "Force created PR to be draft (true/false)"
        required: false
        default: "false"

permissions:
  contents: write
  pull-requests: write
  issues: write

concurrency:
  group: codex-issue-${{ github.event.issue.number || inputs.test_issue || github.run_id }}
  cancel-in-progress: true

jobs:
  bridge:
    uses: ./.github/workflows/reusable-agents-issue-bridge.yml
    secrets: inherit
    with:
      agent: codex
      agent_display: Codex
      workflow_file: agents-63-codex-issue-bridge.yml
      workflow_display: Agents 63 Codex Issue Bridge
      issue_number: ${{ github.event_name == 'workflow_dispatch' && inputs.test_issue || github.event.issue.number || '' }}
      mode: ${{ github.event_name == 'workflow_dispatch' && inputs.pr_mode || '' }}
      pr_draft: ${{ github.event_name == 'workflow_dispatch' && inputs.codex_pr_draft || '' }}
      post_agent_comment: ${{ github.event_name == 'workflow_dispatch' && inputs.post_codex_comment || '' }}
      plan_command: '@codex start'
      execution_command: '@codex plan-and-execute'
      bootstrap_action: ./.github/actions/codex-bootstrap-lite
      assignees: chatgpt-codex-connector,stranske-automation-bot
