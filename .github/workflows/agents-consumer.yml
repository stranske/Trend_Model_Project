name: Agents (Consumer)

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      enable_readiness:
        description: 'Run readiness probe'
        required: false
        default: 'false'
      readiness_agents:
        description: 'Agents to probe (copilot,codex)'
        required: false
        default: 'copilot,codex'
      enable_preflight:
        description: 'Run codex preflight'
        required: false
        default: 'false'
      codex_user:
        description: 'Override codex connector login'
        required: false
        default: ''
      codex_command_phrase:
        description: 'Phrase to post for codex'
        required: false
        default: ''
      enable_diagnostic:
        description: 'Run diagnostic token/branch probe'
        required: false
        default: 'false'
      diagnostic_attempt_branch:
        description: 'Attempt branch create in diagnostic'
        required: false
        default: 'false'
      diagnostic_dry_run:
        description: 'Diagnostic dry run'
        required: false
        default: 'true'
      enable_verify_issue:
        description: 'Verify agent assigned to issue'
        required: false
        default: 'false'
      verify_issue_number:
        description: 'Issue number for verification'
        required: false
        default: ''
      enable_watchdog:
        description: 'Run watchdog sanity'
        required: false
        default: 'true'
      bootstrap_issues_label:
        description: 'Label for codex bootstrap issues'
        required: false
        default: 'agent:codex'
      draft_pr:
        description: 'Open bootstrap PRs as draft'
        required: false
        default: 'false'

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  call-reusable:
    uses: ./.github/workflows/reuse-agents.yml
    with:
      enable_readiness: ${{ inputs.enable_readiness || 'false' }}
      readiness_agents: ${{ inputs.readiness_agents || 'copilot,codex' }}
      enable_preflight: ${{ inputs.enable_preflight || 'false' }}
      codex_user: ${{ inputs.codex_user || '' }}
      codex_command_phrase: ${{ inputs.codex_command_phrase || '' }}
      enable_diagnostic: ${{ inputs.enable_diagnostic || 'false' }}
      diagnostic_attempt_branch: ${{ inputs.diagnostic_attempt_branch || 'false' }}
      diagnostic_dry_run: ${{ inputs.diagnostic_dry_run || 'true' }}
      enable_verify_issue: ${{ inputs.enable_verify_issue || 'false' }}
      verify_issue_number: ${{ inputs.verify_issue_number || '' }}
      enable_watchdog: ${{ inputs.enable_watchdog || 'true' }}
      bootstrap_issues_label: ${{ inputs.bootstrap_issues_label || 'agent:codex' }}
      draft_pr: ${{ inputs.draft_pr || 'false' }}
