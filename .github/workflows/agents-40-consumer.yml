name: Agents (Consumer)

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      enable_readiness:
        description: 'Run readiness probe'
        required: false
        default: 'false'
      readiness_agents:
        description: 'Agents to probe (copilot,codex)'
        required: false
        default: 'copilot,codex'
      readiness_custom_logins:
        description: 'Additional raw bot logins (comma separated)'
        required: false
        default: ''
      enable_preflight:
        description: 'Run codex preflight'
        required: false
        default: 'false'
      codex_user:
        description: 'Override codex connector login'
        required: false
        default: ''
      codex_command_phrase:
        description: 'Phrase to post for codex'
        required: false
        default: ''
      diagnostic_mode:
        description: 'Diagnostic preset: off | dry-run | full'
        required: false
        default: 'off'
      verify_issue_number:
        description: 'Issue number for verification (blank to skip)'
        required: false
        default: ''
      enable_watchdog:
        description: 'Run watchdog sanity'
        required: false
        default: 'true'
      draft_pr:
        description: 'Open bootstrap PRs as draft'
        required: false
        default: 'false'

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  call-reusable:
    uses: ./.github/workflows/reusable-90-agents.yml
    with:
      enable_readiness: ${{ inputs.enable_readiness || 'false' }}
      readiness_agents: ${{ inputs.readiness_agents || 'copilot,codex' }}
      readiness_custom_logins: ${{ inputs.readiness_custom_logins || '' }}
      enable_preflight: ${{ inputs.enable_preflight || 'false' }}
      codex_user: ${{ inputs.codex_user || '' }}
      codex_command_phrase: ${{ inputs.codex_command_phrase || '' }}
      enable_diagnostic: ${{ (inputs.diagnostic_mode || 'off') != 'off' && 'true' || 'false' }}
      diagnostic_attempt_branch: ${{ (inputs.diagnostic_mode || 'off') == 'full' && 'true' || 'false' }}
      diagnostic_dry_run: ${{ (inputs.diagnostic_mode || 'off') == 'full' && 'false' || 'true' }}
      enable_verify_issue: ${{ (inputs.verify_issue_number || '') != '' && 'true' || 'false' }}
      verify_issue_number: ${{ inputs.verify_issue_number || '' }}
      enable_watchdog: ${{ inputs.enable_watchdog || 'true' }}
      bootstrap_issues_label: 'agent:codex'
      draft_pr: ${{ inputs.draft_pr || 'false' }}
