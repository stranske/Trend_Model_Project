name: Reuse Agents

on:
  workflow_call:
    inputs:
      enable_readiness:
        description: 'Run readiness probe (true/false)'
        required: false
        default: 'false'
        type: string
      readiness_agents:
        description: 'Comma-separated agent keys (copilot,codex)'
        required: false
        default: 'copilot,codex'
        type: string
      custom_logins:
        description: 'Comma-separated custom logins to probe in readiness'
        required: false
        default: ''
        type: string
      require_all:
        description: 'Fail readiness when any requested actor missing (true/false)'
        required: false
        default: 'false'
        type: string
      enable_preflight:
        description: 'Run Codex preflight diagnostics (true/false)'
        required: false
        default: 'false'
        type: string
      codex_user:
        description: 'Override Codex connector login for preflight'
        required: false
        default: ''
        type: string
      codex_command_phrase:
        description: 'Command phrase to post during preflight'
        required: false
        default: ''
        type: string
      enable_verify_issue:
        description: 'Verify a specific issue assignment (true/false)'
        required: false
        default: 'false'
        type: string
      verify_issue_number:
        description: 'Issue number to verify when enable_verify_issue is true'
        required: false
        default: ''
        type: string
      enable_watchdog:
        description: 'Run watchdog checks (true/false)'
        required: false
        default: 'true'
        type: string
      enable_keepalive:
        description: 'Run Codex keepalive sweeps (true/false)'
        required: false
        default: 'true'
        type: string
      enable_bootstrap:
        description: 'Run Codex bootstrap workflow (true/false)'
        required: false
        default: 'false'
        type: string
      bootstrap_issues_label:
        description: 'Label used to locate Codex-ready issues'
        required: false
        default: 'agent:codex'
        type: string
      draft_pr:
        description: 'Create Codex bootstrap PRs as draft (true/false)'
        required: false
        default: 'false'
        type: string
      options_json:
        description: 'Optional JSON settings forwarded to reusable toolkit'
        required: false
        default: '{}'
        type: string
    secrets:
      service_bot_pat:
        required: false

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  call:
    timeout-minutes: 60
    uses: ./.github/workflows/reusable-70-agents.yml
    secrets: inherit
    with:
      enable_readiness: ${{ inputs.enable_readiness }}
      readiness_agents: ${{ inputs.readiness_agents }}
      readiness_custom_logins: ${{ inputs.custom_logins }}
      require_all: ${{ inputs.require_all }}
      enable_preflight: ${{ inputs.enable_preflight }}
      codex_user: ${{ inputs.codex_user }}
      codex_command_phrase: ${{ inputs.codex_command_phrase }}
      enable_verify_issue: ${{ inputs.enable_verify_issue }}
      verify_issue_number: ${{ inputs.verify_issue_number }}
      enable_watchdog: ${{ inputs.enable_watchdog }}
      enable_keepalive: ${{ inputs.enable_keepalive }}
      enable_bootstrap: ${{ inputs.enable_bootstrap }}
      bootstrap_issues_label: ${{ inputs.bootstrap_issues_label }}
      draft_pr: ${{ inputs.draft_pr }}
      options_json: ${{ inputs.options_json }}
