name: Verify Codex Bootstrap Matrix

on:
  workflow_dispatch:
  schedule:
    - cron: '17 3 * * *'
  push:
    paths:
      - '.github/workflows/verify-codex-bootstrap-matrix.yml'
      - 'scripts/verify_codex_bootstrap.py'
      - 'docs/codex-simulation.md'
    inputs:
      scenarios:
        description: "Comma-separated list: all or subset. See scripts/verify_codex_bootstrap.py SCENARIOS_IMPL for available scenarios."
        required: false
        default: "all"
      parallel:
        description: "Run scenarios in matrix (true) or sequential harness (false)"
        required: false
        default: "false"
      force_branch_fail:
        description: "Simulate branch creation failure (only for t11_dual_fail)"
        required: false
        default: "false"
      override_allow_fallback:
        description: "Override allow_fallback (true|false|empty for default)"
        required: false
        default: ""
      codex_command:
        description: "Override codex command for t14_invalid_cmd"
        required: false
        default: "codex: start"
      pr_mode:
        description: "Override pr_mode (auto|manual) for t12_manual_mode"
        required: false
        default: "auto"
      suppress_activate:
        description: "Set to true for t13_suppressed"
        required: false
        default: "false"

jobs:
  verify:
    uses: ./.github/workflows/reusable/agents.yml
    secrets: inherit
    with:
      operation: codex_verify
      scenarios: ${{ inputs.scenarios || '' }}
      parallel: ${{ inputs.parallel || '' }}
      force-branch-fail: ${{ inputs.force_branch_fail || '' }}
      override-allow-fallback: ${{ inputs.override_allow_fallback || '' }}
      override-codex-command: ${{ inputs.codex_command || '' }}
      override-pr-mode: ${{ inputs.pr_mode || '' }}
      suppress-activate: ${{ inputs.suppress_activate || '' }}
