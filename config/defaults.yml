# ======================================================================
# Vol-Adjusted Trend Analysis — Phase-1 master config
# ======================================================================
version: "0.1.0" # bump when the schema changes
# ----------------------------------------------------------------------
# 1. DATA INGESTION
# ----------------------------------------------------------------------
data:
  managers_glob: "data/raw/managers/*.csv"
  indices_glob: "data/raw/indices/*.csv"
  date_column: "Date" # ISO-8601 expected
  price_column: "Adj_Close" # or "NAV", etc.
  frequency: "D" # D | W | M
  timezone: "UTC" # for parsing
  currency: "USD"
  missing_policy: "ffill" # drop | ffill | zero
  missing_limit: null      # Optional int (per-column overrides supported)
  lookback_required: 756 # minimum obs (≈3 yrs daily)
# ----------------------------------------------------------------------
# 2. PRE-PROCESSING OPTIONS
# ----------------------------------------------------------------------
preprocessing:
  de_duplicate: true
  winsorise:
    enabled: true
    limits: [0.01, 0.99] # two-sided
  log_prices: false # turn on if prices span decades
  holiday_calendar: "NYSE" # forward fill non-trading days
  resample:
    target: "D" # keep None to skip
    method: "last" # last | mean | sum | pad
    business_only: true
  missing_data:
    policy: drop           # drop | ffill | zero
    limit: null            # max consecutive periods to forward-fill (None = unlimited)
    per_asset: {}          # optional overrides, e.g. {RF: zero}
    per_asset_limit: {}    # optional forward-fill window overrides per asset
# ----------------------------------------------------------------------
# 3. VOLATILITY ADJUSTMENT
# ----------------------------------------------------------------------
vol_adjust:
  enabled: true
  target_vol: 0.10 # annualised (10%)
  window:
    length: 63 # rolling window (≈3 months)
    decay: "ewma" # ewma | simple
    lambda: 0.94 # EWMA decay
  floor_vol: 0.04 # avoid 100× leverage
  warmup_periods: 0 # zero weights for first N periods
# ----------------------------------------------------------------------
# 4. IN-SAMPLE / OUT-OF-SAMPLE SPLIT
# ----------------------------------------------------------------------
sample_split:
  method: "date" # date | ratio
  date: "2017-12-31" # ignored if method=ratio
  ratio: 0.70 # ignored if method=date
  rolling_walk: false # future-phase feature flag
  folds: 5 # for CV, if rolling_walk=true
# ----------------------------------------------------------------------
# 5. PORTFOLIO CONSTRUCTION
# ----------------------------------------------------------------------
portfolio:
  selection_mode: "all" # all | random | manual
  random_n: 10 # num managers if random
  manual_list: [] # filled when selection_mode=manual
  weighting_scheme: "equal" # equal | risk_parity | hrp | erc | robust_mv | robust_risk_parity | custom
  rebalance_freq: "M" # M | Q | A | None
  rebalance_calendar: "NYSE"
  leverage_cap: 2.0 # max gross exposure
  transaction_cost_bps: 0       # linear cost per unit turnover
  cost_model:
    bps_per_trade: 0            # overrides transaction_cost_bps when provided
    slippage_bps: 0             # additional penalty applied on turnover
  max_turnover: 1.0             # optional turnover cap (1.0 = no cap)
  rank:
    inclusion_approach: top_n     # top_n | top_pct | threshold
    n: 10                         # for top_n
    pct: 0.10                     # for top_pct (decimal, not %)
    threshold: 1.5                # ignored unless approach == threshold
    score_by: sharpe_ratio        # Sharpe | AnnualReturn | … | blended
    transform: zscore
    blended_weights:
      Sharpe: 0.5
      AnnualReturn: 0.3
      MaxDrawdown: 0.2
  selector:
    name: zscore            # or 'rank'
    params:
      threshold: 1.0        # σ
  weighting:
    name: score_prop_bayes
    params:
      shrink_tau: 0.25
  constraints:
    long_only: true
    max_weight: 0.25
    group_caps: {}
  # Robustness settings for covariance matrix handling
  robustness:
    # Covariance shrinkage options
    shrinkage:
      enabled: true
      method: "ledoit_wolf"          # none | ledoit_wolf | oas
    # Condition number monitoring and safe mode fallback
    condition_check:
      enabled: true
      threshold: 1.0e12              # maximum allowed condition number
      safe_mode: "hrp"               # hrp | risk_parity | diagonal_mv
      diagonal_loading_factor: 1.0e-6  # for diagonal loading regularization
    # Logging configuration for robustness decisions
    logging:
      log_method_switches: true      # log when switching to safe mode
      log_shrinkage_intensity: true  # log shrinkage parameters
      log_condition_numbers: true    # log matrix condition numbers
# ----------------------------------------------------------------------
# BENCHMARKS
# ----------------------------------------------------------------------
benchmarks:
  # Example mapping from label to column name
  spx: SPX
  tsx: TSX

# ----------------------------------------------------------------------
# 6. REGIME ANALYSIS
# ----------------------------------------------------------------------
regime:
  enabled: true
  proxy: "SPX"
  method: "rolling_return"
  lookback: 126
  smoothing: 3
  threshold: 0.0
  neutral_band: 0.001
  min_observations: 4
  risk_on_label: "Risk-On"
  risk_off_label: "Risk-Off"
  cache: true
  annualise_volatility: true   # applies when method: volatility

# ----------------------------------------------------------------------
# 7. PERFORMANCE METRICS
# ----------------------------------------------------------------------
metrics:
  rf_rate_annual:     0.02            # flat rf or link to series
  use_continuous:     false           # geometric (default) vs. log
  alpha_reference:    "SP500TR"       # ticker in indices_glob
  # ---- new vectorised list drives score_frame v2 -----------------
  registry:
    - annual_return
    - volatility
    - sharpe_ratio
    - sortino_ratio
    - information_ratio
    - max_drawdown
  compute:
    - CAGR
    - Volatility
    - Sharpe
    - Sortino
    - Max_Drawdown
    - Calmar
    - Hit_Rate
    - Skew
  bootstrap_ci:
    enabled: true
    n_iter: 2000
    ci_level: 0.95
# ----------------------------------------------------------------------
# 8. EXPORT OPTIONS
# ----------------------------------------------------------------------
export:
  directory: "results/"
  formats: ["xlsx", "csv", "json"]
  excel:
    autofit_columns: true
    number_format: "0.00%"
    conditional_bands:
      enabled: true
      palette: "RdYlGn"
  include_raw_returns: true
  include_vol_adj: true
  include_figures: false # Phase-2
# ----------------------------------------------------------------------
# 9. LOGGING & EXECUTION
# ----------------------------------------------------------------------
performance:
  enable_cache: true
  incremental_cov: false
  cache:
    metrics: false  # scalar metric series memoization (Issue #1156)
run:
  log_level: "INFO" # DEBUG | INFO | WARNING | ERROR
  log_file: "logs/phase1.log"
  n_jobs: -1 # ‑1 ⇒ all CPUs
  cache_dir: ".cache/"
  deterministic: true # sets NumPy & pandas options


# ---------------------------------------------------------------------------
# Phase‑2 multi‑period defaults
# ---------------------------------------------------------------------------
multi_period:
  frequency: "A"          # M | Q | A  (Monthly, Quarterly, Annual)
  in_sample_len: 3        # rolling windows
  out_sample_len: 1
  start: "1990-01"
  end:   "2024-12"
  triggers:
    sigma1: {sigma: 1, periods: 2}
    sigma2: {sigma: 2, periods: 1}
  min_funds: 10
  max_funds: 25
  weight_curve:
    anchors:              # [rank‑percentile, multiplier]
      - [0,   1.20]
      - [50,  1.00]
      - [100, 0.80]
checkpoint_dir: "outputs/checkpoints/"
jobs: -1                  # -1 = use all logical cores
seed: 42
