#!/usr/bin/env bash
# Development wrapper for trend-model CLI
# Makes 'trend-model' command available without requiring package installation
# Ensures deterministic hash seeding unless user already provided one.

if [[ -z "${PYTHONHASHSEED:-}" ]]; then
    export PYTHONHASHSEED=0
fi

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

if [ -f "${PROJECT_ROOT}/.venv/bin/activate" ]; then
    # shellcheck disable=SC1090
    source "${PROJECT_ROOT}/.venv/bin/activate"
fi

PYTHON_EXEC="python"
if [ -x "${PROJECT_ROOT}/.venv/bin/python" ]; then
    PYTHON_EXEC="${PROJECT_ROOT}/.venv/bin/python"
fi

if ! "$PYTHON_EXEC" - <<'PY' >/dev/null 2>&1; then
import importlib
import sys

try:
    importlib.import_module("trend_analysis.cli")
except ModuleNotFoundError:  # pragma: no cover - shell wrapper guard
    sys.exit(1)
sys.exit(0)
PY
    echo "trend_analysis package not installed. Run 'pip install -e .' first." >&2
    exit 1
fi

exec "$PYTHON_EXEC" -m trend_analysis.cli "$@"
