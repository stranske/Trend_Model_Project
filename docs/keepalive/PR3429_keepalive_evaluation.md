# Keepalive Evaluation â€“ PR 3429 (2025-11-10)

This report reviews keepalive automation activity on pull request [#3429](https://github.com/stranske/Trend_Model_Project/pull/3429)
against the requirements in:

- `docs/keepalive/GoalsAndPlumbing.md`
- `docs/keepalive/SyncChecklist.md`
- `docs/keepalive/Agents.md`

Evidence sources collected during 2025-11-10 include:

- `gh run list --workflow "Agents 70 Orchestrator" --json ... --limit 20`
- `gh run list --branch codex/issue-3428 --status cancelled --json ...`
- `gh run list --workflow "Keepalive Branch Sync" --json ...`
- Timeline export `tmp_logs/pr3429_timeline.json` (latest 100 events)

## 1. Activation Guardrails (Goals & Plumbing Â§1)

| Requirement | Evidence | Status |
| --- | --- | --- |
| `agents:keepalive` label present when instructions post | Timeline shows label removal at 07:07:42Z (`unlabeled` event by `stranske`) while Roundsâ€¯11â€“13 landed between 07:08Z and 07:11Z (`tmp_logs/pr3429_timeline.json`). | âŒ Violated |
| Human kickoff via @mention | Roundâ€¯2 instruction (`06:52:48Z`) authored by `stranske` directly pings `@codex` with the task list. | âœ… |
| Gate success at current head | Instruction comments (e.g. Roundâ€¯10 and Roundâ€¯19) include the â€œLatest Runs: âœ… success â€” Gateâ€ block generated by the orchestrator. | âœ… |

**Impact:** Guardrail labels disappeared for ~6h, yet automation continued posting instructions, breaching Goals Â§1.

## 2. Repeat Contract (Goals & Plumbing Â§2)

- Orchestrator reruns after Roundâ€¯10 ignored the missing label and kept emitting instructions (Roundsâ€¯11â€“13).
- No evidence of a compensating pause or halt was observed.

âŒ Overall â€“ repeat guardrails are not enforced.

## 3. Run Cap Enforcement (Goals & Plumbing Â§3)

The orchestrator ran 12 times in a 10-minute window (14:50:14Z â†’ 15:00Z range) per `gh run list --workflow "Agents 70 Orchestrator"`, demonstrating no effective run cap. Concurrency increases noise and heightens the risk of overlapping traces.

âŒ Violated â€“ cap is not preventing rapid-fire reruns. Follow-up: on 2025-11-10 we updated `evaluateKeepaliveGate` to treat recently completed orchestrator/worker runs (â‰¤5â€¯min window) as part of the active count, so consecutive cron sweeps should now pause once the throttle engages. Need confirmation from the next scheduled cycle.

## 4. Pause & Stop Controls (Goals & Plumbing Â§4)

- `agents:pause` never appeared.
- Despite the critical label gap (07:07Zâ€“13:34Z), automation did not pause rounds.

âŒ Controls failed to halt activity when guardrails broke.

## 5. No-Noise Policy (Goals & Plumbing Â§5)

Twenty-four keepalive instructions (plus duplicate Roundâ€¯5 entries) posted in ~7 hours, including three rounds while guardrails were invalid. The volume and timing constitute contract noise.

âš ï¸ Partially satisfied â€“ instructions are well-formed, but cadence becomes spam once prerequisites fail.

## 6. Instruction Comment Contract (Goals & Plumbing Â§6)

Each instruction comment carries the required hidden markers, scope/tasks tables, testing sections, and receives ğŸ‘€/ğŸš€ reactions. No formatting deviations observed.

âœ… Passed.

## 7. Detection & Dispatch Flow (Goals & Plumbing Â§7)

- `keepalive-state` tracer comments capture head/base metadata (e.g. Roundâ€¯19 at 13:45:03Z).
- Worker success notices (Roundsâ€¯19â€“23) repeat even though Gate reruns keep cancelling (see Â§8), indicating dispatches run but fail to advance the branch.
- Branch-sync workflow (06:26Z) ended `failure` for head `phase-2-dev` (run `19222734980`).
- Maintainer-dispatched rerun `19239811962` (17:09Z) completed successfully after the fetch fix, confirming the dry-run path now reaches merge evaluation.

âš ï¸ Partial â€“ snapshotting occurs, yet downstream sync actions fail to produce a new head.

## 8. Branch-Sync Gate (Goals & Plumbing Â§8 / Sync Checklist)

| Step | Expectation | Evidence | Status |
| --- | --- | --- | --- |
| 1. Snapshot before instruction | Capture head/base at emit time. | `keepalive-state` payloads (Roundsâ€¯17â€“24) include head SHA + refs. | âœ… |
| 2. Short poll â‰¤120â€¯s | Observe new head after worker completes. | No new SHA recorded; repeated â€œworker successâ€ comments without head change. | âš ï¸ |
| 3. Update-branch dispatch | Fire `update-branch` when head unchanged. | Keepalive Branch Sync dry run `19239811962` (trace `dryrun-20251110-fetchfi`) fetched `phase-2-dev`, merged cleanly, and marked the sync as empty after the new `git fetch --no-tags --prune` step. | âœ… |
| 4. Create-pr fallback | Open connector PR and merge. | No timeline references to connector PRs post-round; head stays static. | âŒ |
| 5. Escalate when still stale | Apply `agents:sync-required` and post escalation (if `agents:debug`). | No escalation label/comment despite repeated cancellations. | âŒ |

## 9. Orchestrator Invariants (Goals & Plumbing Â§9)

- Scheduled runs pile up without respecting the run cap (see Â§3).
- Guardrail failures do not abort instructions.

âŒ Invariants broken.

## 10. Restart & Success Conditions (Goals & Plumbing Â§10)

- Keepalive rounds loop without new commits or checklist progress.
- Task list in each instruction remains fully unchecked.

âš ï¸ Pending â€“ automation restarts but never converges.

## Connector Payload Contract (Sync Checklist)

- No evidence that `update-branch` or `create-pr` payloads were accepted; branch never advanced and no connector PR was opened. | âŒ

## Pause Label Clearance

- `agents:sync-required` was never applied, so no clearance occurred. | âš ï¸ Missing escalation.

## Outstanding Actions

1. **Restore guardrail enforcement** â€“ Block instruction emission whenever `agents:keepalive` is absent; add tests mirroring Roundsâ€¯11â€“13 scenario.
2. **Monitor run-cap throttle** â€“ Recent patch counts recently completed runs when enforcing the cap (5â€¯min window). Observe upcoming scheduled sweeps to confirm the throttling halts rapid-fire reruns.
3. **Monitor sync dispatches** â€“ Branch-sync workflow now fetches with `git fetch --no-tags --prune origin "$BASE_REF"`; dry-run `19239811962` verified the empty-merge path. Continue to monitor production runs and capture evidence when a non-empty merge or connector PR is required.
4. **Add failure escalation** â€“ Ensure stale heads after update/create attempts apply `agents:sync-required` and post the escalation note.
5. **Document outcome** â€“ Update `docs/keepalive/AttemptLog_Nov2025.md` and guardrail docs once fixes land.

## Remediation Notes (2025-11-10)

- Timeline gap: `agents:keepalive` absent 07:07Zâ€“13:34Z while three rounds continued to post.
- Gate churn: at least nine Gate runs cancelled on `codex/issue-3428` between 13:32Z and 14:50Z (command output above).
- Orchestrator cadence: 12 runs triggered in 10 minutes (`19235652928` â†’ `19236890071`).
- Branch sync: latest failure `19222734980` (phase-2-dev) recorded minutes before the PR keepalive burst.
- Branch sync detail: job `Prepare sync branch` formerly aborted with `fatal: depth 0 is not a positive number`, blocking the update-branch fallback.
- Workflow patch: `agents-keepalive-branch-sync.yml` now uses `git fetch --no-tags --prune origin "$BASE_REF"`; dry run `19239811962` completed successfully (sync empty), validating the fix.
